!function(){function t(t){var e=this.init(t);this._saveInitParam(),this.logToConsoleCookieName="JL_Ranking_log_to_console",this.logToConsole=o._isConsoleCookieExists(this.logToConsoleCookieName),this.log("initialized with "+e+" params."),this.log("Ranker initialized with "+e+" parameters\n\t - cid              :"+this.params.cid+"\n\t - user id          :"+this.params.id+"\n\t - limit            :"+this.params.limit+"\n\t - campaign         :"+this.params.campaign+"\n\t - feed id          :"+this.params.feed+"\n\t - type             :"+this.type)}JL_RANKER={init:function(o){JL_RANKER.ranker=new t(o),JL_RANKER.get_products=JL_RANKER.ranker.get_products.bind(JL_RANKER.ranker),JL_RANKER.get_promos=JL_RANKER.ranker.get_promos.bind(JL_RANKER.ranker),JL_RANKER.get_catalogs=JL_RANKER.ranker.get_catalogs.bind(JL_RANKER.ranker),JL_RANKER.get_layout=JL_RANKER.ranker.get_layout.bind(JL_RANKER.ranker),JL_RANKER.rank_products=JL_RANKER.ranker.rank_products.bind(JL_RANKER.ranker),JL_RANKER.products_by_filter=JL_RANKER.ranker.products_by_filter.bind(JL_RANKER.ranker),JL_RANKER.products_by_ids=JL_RANKER.ranker.products_by_ids.bind(JL_RANKER.ranker),JL_RANKER.products_by_demand=JL_RANKER.ranker.products_by_demand.bind(JL_RANKER.ranker)},id:0},t.prototype.init=function(t){var e=this;e.params=e.params?e.params:{},e.client_callback=e.client_callback?e.client_callback:{};var r=0,i=!1;return o._traverseObject(t,function(t,o){switch(r++,t){case"callback":i=o;break;case"type":e.type=o;break;case"feed":e.params.feed=o;break;case"mode":e.params.mode=o;break;case"data":case"jl_context":break;case"product_id":case"jl_product_id":case"product_ids":case"jl_product_ids":(n=o.toString())&&(e.params.product_id=n);break;case"exclude_product_id":case"jl_exclude_product_id":case"exclude_product_ids":case"jl_exclude_product_ids":var n;(n=o.toString())&&(e.params.exclude_product_id=n);break;case"secure":case"jl_secure":e.params.jl_secure=o;break;default:e.params[t]=o}}),e.type=void 0===e.type?"json":e.type,e.params.id=""!==e.params.id?e.params.id:"undefined",e.params.jl_secure=void 0===e.params.jl_secure||e.params.jl_secure,i.constructor==Function&&e._set_callback(i),r},t.prototype.get_products=function(t,o){this._restoreInitParam(),(this.params.product_id||this.params.jl_product_id||this.params.product_ids||this.params.jl_product_ids)&&!this.params.mode&&(this.params.mode="product_specific"),void 0!==o&&(o.product_id||o.jl_product_id||o.product_ids||o.jl_product_ids)&&!o.mode&&(this.params.mode="product_specific"),this._get_response(this._buildOffersUrl,t,o)},t.prototype.rank_products=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};n.type="rank_json",n.mode="sort_by_relevance";var s=n.product_id||n.product_ids||n.jl_product_id||n.jl_product_ids;void 0!==s&&(n.limit=s.length,n.product_id=s.slice(0,150),delete n.product_ids,delete n.jl_product_ids,delete n.jl_product_id),this._get_response(this._buildOffersUrl,i,n)},t.prototype.products_by_filter=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};this._get_response(this._buildProductsByFilterUrl,i,n)},t.prototype.products_by_ids=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{},s=n.product_id||n.product_ids||n.jl_product_id||n.jl_product_ids;n.product_id=s.slice(0,150),delete n.product_ids,delete n.jl_product_ids,delete n.jl_product_id,this._get_response(this._buildProductsByIdsUrl,i,n)},t.prototype.products_by_demand=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};this._get_response(this._buildProductsByDemandUrl,i,n)},t.prototype.get_promos=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};"undefined"!==n.dimension&&(void 0===n.tile&&(n.tile=n.dimension),delete n.dimension),n.type="promos_json",this.log("get promos params",n),this._get_response(this._buildPromoUrl,i,n)},t.prototype.get_catalogs=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};"undefined"!==n.layer&&(void 0===n.collection&&(n.collection=n.layer),delete n.layer),n.type="catalogs_json",this.log("get catalogs params",n),this._get_response(this._buildCatalogUrl,i,n)},t.prototype.get_layout=function(t,o){this._restoreInitParam();var e=void 0!==t&&t.constructor==Function?t:o,r=void 0!==o&&o.constructor==Object?o:t,i=void 0!==e&&e.constructor==Function?e:function(){},n=void 0!==r&&r.constructor==Object?r:{};n.type="layout_json",this.log("get layout params",n),this._get_response(this._buildLayoutUrl,i,n)},t.prototype._saveInitParam=function(){this._back_up_init_params=o._deepCopyObject(this.params),this.log("_saveInitParam: ",this._back_up_init_params)},t.prototype._restoreInitParam=function(){delete this.params,this.params=o._deepCopyObject(this._back_up_init_params),this.log("restore current param: ",this.params)},t.prototype._get_response=function(t,e,r){var i=void 0!==e&&e.constructor==Function?e:r,n=void 0!==r&&r.constructor==Object?r:e;void 0!==n&&n.constructor==Object&&this.init(n),void 0!==i&&i.constructor==Function&&this._set_callback(i);var s=t(this,JL_RANKER.id);o._jsonp(this,s)},t.prototype._set_callback=function(t){JL_RANKER.id=JL_RANKER.id+1;var o=this._get_callback_name(JL_RANKER.id);JL_RANKER[o]=this[this._get_callback_name("")](t)},t.prototype._callback_json=function(t){var o=this;return function(e){if(o.log("received api response, sending json response"),void 0!==e.product_ids)t(e);else{var r=[];void 0!==e.deals?r=e.deals:void 0!==e.products&&(r=e.products);var i=r.map(function(t){var o=t;return o.current_price=o.current_price/100,o.original_price=o.original_price/100,o});t(i)}}},t.prototype._callback_layout_json=function(t){var o=this;return function(e){o.log("received layout api response, sending json response"),t(e)}},t.prototype._callback_promos_json=function(t){var o=this;return function(e){o.log("received layout api response for promos, sending json response"),t({data:e.promos})}},t.prototype._callback_catalogs_json=function(t){var o=this;return function(e){o.log("received layout api response for catalogs, sending json response"),t({data:e.catalogs})}},t.prototype._callback_rank_json=function(t){var o=this;return function(e){o.log("received rank api response, sending json response");var r=e.deals.map(function(t){return t.id});t(r)}},t.prototype._callback_html=function(t){var o=this;return function(e){var r=o._build_dom(e,o._build_img_object);t(r),o.log("received api response, building dom response")}},t.prototype._build_dom=function(t,o){var e=[];for(var r in t.deals)e.push(o(t.deals[r]));return e},t.prototype._build_img_object=function(t){var o=document.createElement("a");o.setAttribute("class","jl-product-link"),o.setAttribute("href",t.url);var e=document.createElement("img");return e.setAttribute("class","jl-product-img"),e.setAttribute("id","jl-on-site-"+t.id),e.setAttribute("alt",t.title),e.setAttribute("src",t.img),o.appendChild(e),o},t.prototype._get_callback_name=function(t){return"_callback_"+this.type+t},t.prototype._buildUrl=function(t,e,r){return 0==t.params.jl_secure&&(r=r.replace(/^https?\:\/\//i,"http://")),"boolean"==typeof t.params.secure_img_url?(!1===t.params.secure_img_url?t.params.jl_secure=!1:delete t.params.jl_secure,delete t.params.secure_img_url):delete t.params.jl_secure,r+"?"+o._objectToQueryString(t.params)+("callback=JL_RANKER."+t._get_callback_name(e))},t.prototype._buildProductsByFilterUrl=function(t,o){return t._buildProductUrl(t,o,"products_by_filter.json")},t.prototype._buildProductsByIdsUrl=function(t,o){return t._buildProductUrl(t,o,"products_by_ids.json")},t.prototype._buildProductsByDemandUrl=function(t,o){return t._buildProductUrl(t,o,"products_by_demand.json")},t.prototype._buildProductUrl=function(t,o,e){return t._buildUrl(t,o,t.productEndpoint+e)},t.prototype._buildOffersUrl=function(t,o){return t._buildUrl(t,o,t.offersEndpoint)},t.prototype._buildLayoutUrl=function(t,o){return t._buildUrl(t,o,t.layoutEndpoint)},t.prototype._buildCatalogUrl=function(t,o){return t._buildUrl(t,o,t.catalogEndpoint)},t.prototype._buildPromoUrl=function(t,o){return t._buildUrl(t,o,t.promoEndpoint)},t.prototype.enableLog=function(){this.logToConsole=!0,this.log("Stored enable log to console 'marker' cookie. Will expire in 1800000 milliseconds"),o._setCookie(this.logToConsoleCookieName,(new Date).getTime(),18e5),this.log("JL logging Enabled")},t.prototype.disableLog=function(){this.log("Removed enable log to console 'marker' cookie"),this.logToConsole=!1,this.log("Stored enable log to console 'marker' cookie. Will expire in -1800000 milliseconds"),o._setCookie(this.logToConsoleCookieName,(new Date).getTime(),-18e5),this.log("JL logging Disabled")},t.prototype.log=function(t){this.logToConsole&&window.console&&window.console.log&&console.log(t)};var o={_traverseObject:function(t,o){for(var e in t)t.hasOwnProperty(e)&&o(e,t[e])},_deepCopyObject:function(t){var o={};return this._traverseObject(t,function(t,e){o[t]=e}),o},_objectToQueryString:function(t){var o="";return this._traverseObject(t,function(t,e){var r="object"==typeof e?JSON.stringify(e):e;o+=encodeURIComponent(t)+"="+encodeURIComponent(r)+"&"}),o},_jsonp:function(t,o){var e=document.createElement("script");e.type="text/javascript",e.src=o,e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),t.log("SENT JSONP request: "+o)},_getUTCTime:function(){return new Date(this.getUTCFullYear(),this.getUTCMonth(),this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()).getTime()},_getCookie:function(t){for(var o=t+"=",e=document.cookie.split(";"),r=0;r<e.length;r++){for(var i=e[r];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(o))return i.substring(o.length,i.length)}return""},_setCookie:function(t,o,e){var r=new Date;r.setTime(r.getTime()+e);var i="expires="+r.toUTCString();document.cookie=t+"="+o+"; Path=/; "+i},_isConsoleCookieExists:function(t){return""!==o._getCookie(t)}};t.prototype.offersEndpoint="https://api.jetlore.com/offers/offers.json",t.prototype.layoutEndpoint="https://api.jetlore.com/layouts/layout.json",t.prototype.productEndpoint="https://api.jetlore.com/products/",t.prototype.catalogEndpoint="https://api.jetlore.com/layouts/catalogs.json",t.prototype.promoEndpoint="https://api.jetlore.com/layouts/promos.json"}();